/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package pantallas.administracionPeliculas;

import DTOs.PeliculaDTO;
import control.ControlDeNavegacion;
import control.IControl;
import java.awt.GridBagLayout;
import java.awt.HeadlessException;
import java.awt.Image;
import java.awt.image.BufferedImage;
import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStream;
import javax.imageio.ImageIO;
import javax.swing.ImageIcon;
import javax.swing.JLabel;
import javax.swing.JOptionPane;

/**
 *
 * @author Daniel M
 */
public class DetallesPelicula extends javax.swing.JFrame {

    private final IControl control = ControlDeNavegacion.getInstancia();
    private PeliculaDTO peliculaDTO = new PeliculaDTO();

    /**
     * Creates new form DetallesPelicula
     *
     * @param peliculaDTO
     */
    public DetallesPelicula(PeliculaDTO peliculaDTO) {
        initComponents();
        this.peliculaDTO = peliculaDTO;
        cargarDetallesPelicula(peliculaDTO);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jlabelTitulo = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jPanelImagenPelicula = new javax.swing.JPanel();
        jlabelGenero = new javax.swing.JLabel();
        jlabelTitulo2 = new javax.swing.JLabel();
        jlabelClasificacion = new javax.swing.JLabel();
        jlabelDuracion = new javax.swing.JLabel();
        jlabelSinopsis = new javax.swing.JLabel();
        btnEditarPelicula = new javax.swing.JButton();
        btnDarBaja = new javax.swing.JButton();
        btnEliminar = new javax.swing.JButton();
        btnaVolver = new javax.swing.JButton();
        jlabelTituloDetalles = new javax.swing.JLabel();
        jLabelMostrarTitulo = new javax.swing.JLabel();
        jLabelMostrarGenero = new javax.swing.JLabel();
        jLabelMostrarDuracion = new javax.swing.JLabel();
        jLabelMostrarClasificacion = new javax.swing.JLabel();
        jLabelMostrarSinopsis = new javax.swing.JLabel();

        jlabelTitulo.setFont(new java.awt.Font("Tw Cen MT Condensed", 1, 48)); // NOI18N
        jlabelTitulo.setText("Peliculas en Cartelera");

        jLabel3.setText("jLabel1");

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setMaximumSize(new java.awt.Dimension(650, 880));
        setMinimumSize(new java.awt.Dimension(650, 880));
        setResizable(false);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jPanelImagenPelicula.setMaximumSize(new java.awt.Dimension(225, 325));
        jPanelImagenPelicula.setMinimumSize(new java.awt.Dimension(225, 325));

        javax.swing.GroupLayout jPanelImagenPeliculaLayout = new javax.swing.GroupLayout(jPanelImagenPelicula);
        jPanelImagenPelicula.setLayout(jPanelImagenPeliculaLayout);
        jPanelImagenPeliculaLayout.setHorizontalGroup(
            jPanelImagenPeliculaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 225, Short.MAX_VALUE)
        );
        jPanelImagenPeliculaLayout.setVerticalGroup(
            jPanelImagenPeliculaLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 325, Short.MAX_VALUE)
        );

        getContentPane().add(jPanelImagenPelicula, new org.netbeans.lib.awtextra.AbsoluteConstraints(19, 105, -1, -1));

        jlabelGenero.setFont(new java.awt.Font("Tw Cen MT Condensed", 1, 18)); // NOI18N
        jlabelGenero.setText("Género:");
        getContentPane().add(jlabelGenero, new org.netbeans.lib.awtextra.AbsoluteConstraints(262, 153, -1, -1));

        jlabelTitulo2.setFont(new java.awt.Font("Tw Cen MT Condensed", 1, 18)); // NOI18N
        jlabelTitulo2.setText("Título:");
        getContentPane().add(jlabelTitulo2, new org.netbeans.lib.awtextra.AbsoluteConstraints(262, 111, -1, -1));

        jlabelClasificacion.setFont(new java.awt.Font("Tw Cen MT Condensed", 1, 18)); // NOI18N
        jlabelClasificacion.setText("Clasificación:");
        getContentPane().add(jlabelClasificacion, new org.netbeans.lib.awtextra.AbsoluteConstraints(262, 237, -1, -1));

        jlabelDuracion.setFont(new java.awt.Font("Tw Cen MT Condensed", 1, 18)); // NOI18N
        jlabelDuracion.setText("Duración:");
        getContentPane().add(jlabelDuracion, new org.netbeans.lib.awtextra.AbsoluteConstraints(262, 195, -1, -1));

        jlabelSinopsis.setFont(new java.awt.Font("Tw Cen MT Condensed", 1, 18)); // NOI18N
        jlabelSinopsis.setText("Sinopsis:");
        getContentPane().add(jlabelSinopsis, new org.netbeans.lib.awtextra.AbsoluteConstraints(262, 279, -1, -1));

        btnEditarPelicula.setBackground(new java.awt.Color(162, 132, 94));
        btnEditarPelicula.setFont(new java.awt.Font("Tw Cen MT", 1, 18)); // NOI18N
        btnEditarPelicula.setForeground(new java.awt.Color(255, 255, 255));
        btnEditarPelicula.setText("Editar");
        btnEditarPelicula.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEditarPeliculaActionPerformed(evt);
            }
        });
        getContentPane().add(btnEditarPelicula, new org.netbeans.lib.awtextra.AbsoluteConstraints(262, 590, 128, -1));

        btnDarBaja.setBackground(new java.awt.Color(162, 132, 94));
        btnDarBaja.setFont(new java.awt.Font("Tw Cen MT", 1, 18)); // NOI18N
        btnDarBaja.setForeground(new java.awt.Color(255, 255, 255));
        btnDarBaja.setText("Dar de baja");
        btnDarBaja.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDarBajaActionPerformed(evt);
            }
        });
        getContentPane().add(btnDarBaja, new org.netbeans.lib.awtextra.AbsoluteConstraints(262, 639, -1, -1));

        btnEliminar.setBackground(new java.awt.Color(162, 132, 94));
        btnEliminar.setFont(new java.awt.Font("Tw Cen MT", 1, 18)); // NOI18N
        btnEliminar.setForeground(new java.awt.Color(255, 255, 255));
        btnEliminar.setText("Eliminar");
        btnEliminar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEliminarActionPerformed(evt);
            }
        });
        getContentPane().add(btnEliminar, new org.netbeans.lib.awtextra.AbsoluteConstraints(262, 688, 128, -1));

        btnaVolver.setBackground(new java.awt.Color(162, 132, 94));
        btnaVolver.setFont(new java.awt.Font("Tw Cen MT", 1, 18)); // NOI18N
        btnaVolver.setForeground(new java.awt.Color(255, 255, 255));
        btnaVolver.setText("< Volver");
        btnaVolver.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnaVolverActionPerformed(evt);
            }
        });
        getContentPane().add(btnaVolver, new org.netbeans.lib.awtextra.AbsoluteConstraints(19, 782, -1, -1));

        jlabelTituloDetalles.setFont(new java.awt.Font("Tw Cen MT Condensed", 1, 48)); // NOI18N
        jlabelTituloDetalles.setText("Detalles Película");
        getContentPane().add(jlabelTituloDetalles, new org.netbeans.lib.awtextra.AbsoluteConstraints(140, 30, -1, -1));

        jLabelMostrarTitulo.setText("jLabel1");
        getContentPane().add(jLabelMostrarTitulo, new org.netbeans.lib.awtextra.AbsoluteConstraints(324, 117, -1, -1));

        jLabelMostrarGenero.setText("jLabel1");
        getContentPane().add(jLabelMostrarGenero, new org.netbeans.lib.awtextra.AbsoluteConstraints(340, 159, -1, -1));

        jLabelMostrarDuracion.setText("jLabel1");
        getContentPane().add(jLabelMostrarDuracion, new org.netbeans.lib.awtextra.AbsoluteConstraints(353, 201, -1, -1));

        jLabelMostrarClasificacion.setText("jLabel1");
        getContentPane().add(jLabelMostrarClasificacion, new org.netbeans.lib.awtextra.AbsoluteConstraints(386, 243, -1, -1));

        jLabelMostrarSinopsis.setText("jLabel1");
        getContentPane().add(jLabelMostrarSinopsis, new org.netbeans.lib.awtextra.AbsoluteConstraints(262, 309, -1, -1));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnEditarPeliculaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEditarPeliculaActionPerformed

    }//GEN-LAST:event_btnEditarPeliculaActionPerformed

    private void btnDarBajaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDarBajaActionPerformed
        darDeBajaPelicula(peliculaDTO);
    }//GEN-LAST:event_btnDarBajaActionPerformed

    private void btnEliminarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEliminarActionPerformed
        eliminarPelicula(peliculaDTO);
    }//GEN-LAST:event_btnEliminarActionPerformed

    private void btnaVolverActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnaVolverActionPerformed
        control.mostrarMenuAdministrarPeliculas(this);
        dispose();
    }//GEN-LAST:event_btnaVolverActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnDarBaja;
    private javax.swing.JButton btnEditarPelicula;
    private javax.swing.JButton btnEliminar;
    private javax.swing.JButton btnaVolver;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabelMostrarClasificacion;
    private javax.swing.JLabel jLabelMostrarDuracion;
    private javax.swing.JLabel jLabelMostrarGenero;
    private javax.swing.JLabel jLabelMostrarSinopsis;
    private javax.swing.JLabel jLabelMostrarTitulo;
    private javax.swing.JPanel jPanelImagenPelicula;
    private javax.swing.JLabel jlabelClasificacion;
    private javax.swing.JLabel jlabelDuracion;
    private javax.swing.JLabel jlabelGenero;
    private javax.swing.JLabel jlabelSinopsis;
    private javax.swing.JLabel jlabelTitulo;
    private javax.swing.JLabel jlabelTitulo2;
    private javax.swing.JLabel jlabelTituloDetalles;
    // End of variables declaration//GEN-END:variables

    private void cargarDetallesPelicula(PeliculaDTO peliculaDTO) {
        jLabelMostrarTitulo.setText(peliculaDTO.getTitulo());
        jLabelMostrarGenero.setText(peliculaDTO.getGenero());
        jLabelMostrarDuracion.setText(peliculaDTO.getDuracion().toString() + " minutos");
        jLabelMostrarClasificacion.setText(peliculaDTO.getClasificacion());
        jLabelMostrarSinopsis.setText("<html><body style='width:250px'>" + peliculaDTO.getSinopsis() + "</body></html>");
        cargarImagenPromocional(peliculaDTO);
    }

    private void darDeBajaPelicula(PeliculaDTO peliculaDTO) {
        int respuesta = JOptionPane.showConfirmDialog(
                this,
                "¿Estás seguro de que deseas dar de baja la película '" + peliculaDTO.getTitulo() + "'?",
                "Confirmar baja",
                JOptionPane.YES_NO_OPTION,
                JOptionPane.QUESTION_MESSAGE
        );

        if (respuesta == JOptionPane.YES_OPTION) {
            boolean exito = control.darBajaPelicula(peliculaDTO);
            if (exito) {
                JOptionPane.showMessageDialog(this, "La película fue dada de baja correctamente.", "Éxito", JOptionPane.INFORMATION_MESSAGE);
            }
        }
    }

    private void eliminarPelicula(PeliculaDTO peliculaDTO) {
        int respuesta = JOptionPane.showConfirmDialog(
                this,
                "¿Estás seguro de que deseas eliminar la película '" + peliculaDTO.getTitulo() + "'? Esta acción no se puede deshacer.",
                "Confirmar eliminación",
                JOptionPane.YES_NO_OPTION,
                JOptionPane.WARNING_MESSAGE
        );

        if (respuesta == JOptionPane.YES_OPTION) {
            boolean exito = control.eliminarPelicula(peliculaDTO);
            if (exito) {
                JOptionPane.showMessageDialog(this, "Película eliminada correctamente.", "Eliminación exitosa", JOptionPane.INFORMATION_MESSAGE);
            }
        }
    }

    private void cargarImagenPromocional(PeliculaDTO peliculaDTO) {
        try {
            byte[] bytesImagen = peliculaDTO.getImagen();
            if (bytesImagen == null) {
                System.out.println("No hay imagen en la película.");
                return;
            }

            InputStream is = new ByteArrayInputStream(bytesImagen);
            BufferedImage imagen = ImageIO.read(is);

            if (imagen == null) {
                System.out.println("No se pudo leer la imagen desde los bytes.");
                return;
            }

            int panelWidth = jPanelImagenPelicula.getWidth();
            int panelHeight = jPanelImagenPelicula.getHeight();

            int imgWidth = imagen.getWidth();
            int imgHeight = imagen.getHeight();

            // Cálculo del aspect ratio
            double panelRatio = (double) panelWidth / panelHeight;
            double imgRatio = (double) imgWidth / imgHeight;

            int drawWidth, drawHeight;
            if (imgRatio > panelRatio) {
                drawWidth = panelWidth;
                drawHeight = (int) (panelWidth / imgRatio);
            } else {
                drawHeight = panelHeight;
                drawWidth = (int) (panelHeight * imgRatio);
            }

            // Escalar la imagen
            Image imagenEscalada = imagen.getScaledInstance(drawWidth, drawHeight, Image.SCALE_SMOOTH);
            ImageIcon icono = new ImageIcon(imagenEscalada);

            // Limpiar el panel y dibujar la imagen centrada
            jPanelImagenPelicula.removeAll();
            jPanelImagenPelicula.setLayout(new GridBagLayout()); // Centrado automático
            jPanelImagenPelicula.add(new JLabel(icono));
            jPanelImagenPelicula.revalidate();
            jPanelImagenPelicula.repaint();

        } catch (IOException e) {
            JOptionPane.showMessageDialog(this, "Error al cargar la imagen promocional.", "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

}
